<html>
<head>
  <title>A D3 map</title>
  <script src="http://d3js.org/d3.v3.min.js" charset="utf-8"></script>
  <script src="//d3js.org/topojson.v1.min.js"></script>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.0/jquery.min.js"></script>
</head>
<body>
  <script>
  $.get( "data/virginia", function( data ) {
    var width = 700,
        height = 580;
    //debugger;
    var svg = d3.select( "body" )
      .append( "svg" )
      .attr( "width", width )
      .attr( "height", height );

    var g = svg.append( "g" );
    debugger;
    let features = topojson.feature(data, data.objects['vaprecincts2016-3']).features;

    var projection = d3.geo.projection(function(x, y) { return [x, y];})
      .precision(0).scale(1).translate([0, 0]);

    var path = d3.geo.path().projection(projection);

    // var bounds = path.bounds(features),
    //     scale  = .95 / Math.max((bounds[1][0] - bounds[0][0]) / width, 
    //             (bounds[1][1] - bounds[0][1]) / height),
    //     transl = [(width - scale * (bounds[1][0] + bounds[0][0])) / 2, 
    //             (height - scale * (bounds[1][1] + bounds[0][1])) / 2];
    // console.log(scale);
    // console.log(transl);
    // console.log(bounds);
    // projection.scale(scale).translate(transl);

    console.log('drawing');
    g.selectAll( "path" )
      .data( features )
      .enter()
      .append( "path" )
      .attr( "fill", "#ccc" )
      .attr( "d", path )
      .attr( "stroke", "red");

  var bounds = path.bounds(),
      dx = bounds[1][0] - bounds[0][0],
      dy = bounds[1][1] - bounds[0][1],
      x = (bounds[0][0] + bounds[1][0]) / 2,
      y = (bounds[0][1] + bounds[1][1]) / 2,
      scale = .9 / Math.max(dx / width, dy / height),
      translate = [width / 2 - scale * x, height / 2 - scale * y];
  g.transition()
      .duration(750)
      .style("stroke-width", 1.5 / scale + "px")
      .attr("transform", "translate(" + translate + ")scale(" + scale + ")");
    console.log('done drawing');

  }, "json");




  </script>
</body>
</html>